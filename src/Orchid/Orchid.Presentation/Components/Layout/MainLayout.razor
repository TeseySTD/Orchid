@inherits LayoutComponentBase

<MudThemeProvider @ref="_mudThemeProvider" @bind-IsDarkMode="_isDarkMode" Theme="_theme"/>
<MudDialogProvider/>
<MudSnackbarProvider/>
<MudPopoverProvider/>

<MudLayout>
    <CascadingValue Value="this">
        <CustomErrorBoundary>
            <Orchid.Presentation.Components.Layout.Header/>
            <MudMainContent Style="height: 100vh;">
                @Body
            </MudMainContent>
        </CustomErrorBoundary>
    </CascadingValue>
</MudLayout>

@code {
    private bool _isDarkMode;
    private MudThemeProvider _mudThemeProvider = null!;

    private readonly MudTheme _theme = new()
    {
        PaletteLight = new PaletteLight()
        {
            Primary = "#72002A", // --md-sys-color-primary
            Secondary = "#8D4A57", // --md-sys-color-secondary
            AppbarBackground = "#72002A",
            Background = "#FFF8F7", // --md-sys-color-background
            Surface = "#FFF8F7", // --md-sys-color-surface
            TextPrimary = "#25181A", // --md-sys-color-on-background
            TextSecondary = "#574144",
            Error = "#BA1A1A"
        },
        PaletteDark = new PaletteDark()
        {
            Primary = "#FFB2BE", // --md-sys-color-primary (Dark)
            Secondary = "#FFB2BE", // --md-sys-color-secondary (Dark)
            AppbarBackground = "#1C1012",
            Background = "#1C1012", // --md-sys-color-background (Dark)
            Surface = "#1C1012", // --md-sys-color-surface (Dark)
            TextPrimary = "#F4DDDF", // --md-sys-color-on-background (Dark)
            TextSecondary = "#DED1D3",
            Error = "#FFB4AB"
        }
    };


    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _isDarkMode = await _mudThemeProvider.GetSystemDarkModeAsync();
            await _mudThemeProvider.WatchSystemDarkModeAsync(OnSystemPreferenceChanged);
            await InvokeAsync(StateHasChanged);
        }
    }

    private async Task OnSystemPreferenceChanged(bool newValue)
    {
        _isDarkMode = newValue;
        await InvokeAsync(StateHasChanged);
    }

    public void ToggleTheme()
    {
        _isDarkMode = !_isDarkMode;
        StateHasChanged();
    }

}
